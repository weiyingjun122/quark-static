<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>夸克网盘资源搜索</title>
<style>
    body { text-align: center; font-family: Arial, sans-serif; background: #f7f7f7; }
    .logo { margin-top: 50px; }
    .logo img { width: 200px; }
    .logo h1 { margin: 20px 0; font-size: 28px; color: #333; }
    .search-box { margin-top: 30px; }
    input[type="text"] { width: 300px; padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
    button { padding: 10px 20px; font-size: 16px; border-radius: 5px; border: none; background-color: #4CAF50; color: white; cursor: pointer; }
    button:hover { background-color: #45a049; }
    .btn { display: inline-block; padding: 10px 20px; background-color: #2196F3; color: #fff; text-decoration: none; border-radius: 5px; margin-top: 10px; }
    .btn:hover { background-color: #0b7dda; }

    /* 弹窗样式 */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0; top: 0;
        width: 100%; height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 400px;
        text-align: center;
        position: relative;
    }
    .close {
        color: #aaa;
        position: absolute;
        top: 10px; right: 15px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close:hover { color: #000; }
</style>
</head>
<body>

<div class="logo">
    <img src="static/logo.png" alt="夸克网盘">
    <h1>夸克网盘资源搜索</h1>
</div>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="请输入资源关键词">
    <button id="searchBtn">搜索</button>
</div>

<!-- 弹窗 -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<script>
async function search() {
    const keywordInput = document.getElementById("keyword");
    if (!keywordInput) return;

    const keyword = keywordInput.value.trim().toLowerCase();
    if (!keyword) return;

    const modal = document.getElementById("modal");
    const modalBody = document.getElementById("modal-body");
    const isMobile = /Mobi|Android|iPhone/i.test(navigator.userAgent);

    // 找到第一条匹配资源，增加安全检查
    const item = data.find(d => {
        const title = (d.title || "").toLowerCase();
        const keywords = Array.isArray(d.keywords) ? d.keywords.map(k => (k||"").toLowerCase()) : [];
        return title.includes(keyword) || keywords.some(k => k.includes(keyword));
    });

    let html = '';

    if (item) {
        html += `<h3>${item.title}</h3>`;
        html += `<p>请使用下方方式访问资源：</p>`;
        if (isMobile) {
            html += `<a href="${item.share_link}" target="_blank" class="btn">点击前往</a>`;
        } else {
            html += `<img src="${item.qrcode}" alt="二维码" style="width:200px;height:200px;">`;
        }
    } else {
        html += `<p>未找到资源</p>
                 <p>请扫码加群获取更多资源</p>`;
        html += `<img src="static/wechat_qrcode.png" alt="加群二维码" style="width:350px;height:350px;">`;
    }

    if (modalBody && modal) {
        modalBody.innerHTML = html;
        modal.style.display = "block"; // 弹窗显示
    }
}

// 搜索按钮绑定
//document.getElementById('searchBtn').onclick = search;
document.getElementById("searchBtn").addEventListener("click", search);

// 回车搜索
document.getElementById('searchInput').addEventListener('keypress', function(e){
    if(e.key === 'Enter') search();
});

// 关闭弹窗
document.getElementById("modal-close").addEventListener("click", () => {
    document.getElementById("modal").style.display = "none";
});

// 点击弹窗外区域关闭
window.onclick = function(event) {
    const modal = document.getElementById('modal');
    if (event.target === modal) modal.style.display = 'none';
}
</script>

</body>
</html>
