<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤¸å…‹ç½‘ç›˜èµ„æºæœç´¢</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; padding-top: 50px; margin:0; }

/* logo */
.logo { text-align: center; margin-bottom: 40px; flex-shrink: 0; }
.logo img { max-width: 150px; height: auto; display: block; margin: 0 auto; }
.logo h1 { margin-top: 10px; font-size: 28px; color: #333; }

/* æœç´¢æ¡† */
.search-container { display: flex; justify-content: center; margin-bottom: 20px; flex-wrap: nowrap; width: 90%; max-width: 480px; }
.search-container input[type="text"] { flex: 1; padding: 10px; font-size: 16px; border-radius: 5px 0 0 5px; border: 1px solid #ccc; outline: none; }
.search-container button { padding: 10px 20px; font-size: 16px; border-radius: 0 5px 5px 0; border: 1px solid #1e90ff; background-color: #1e90ff; color: white; cursor: pointer; }
.search-container button:hover { background-color: #0f78d1; }

.highlight { color: #e74c3c; font-weight: bold; }

/* æ¨èåŒº */
#recommend { width: 100%; max-width: 480px; margin-bottom: 20px; }
.recommend-card { display: flex; flex-wrap: wrap; gap: 10px; background:#fff; padding:15px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,.1); }
.recommend-card h3 { width:100%; margin-bottom:10px; }
.hot-keyword { flex: 1 1 auto; padding: 8px 14px; background: #f0f6ff; border-radius: 25px; text-align: center; cursor: pointer; transition: all 0.2s; }
.hot-keyword:hover { background:#d0e4ff; transform: scale(1.05); }

/* çƒ­é—¨ç¨‹åº¦å­—ä½“å¤§å°å’Œé¢œè‰² */
.hot-keyword[data-count] {
    font-weight: 500;
    color: #1e90ff;
}
.hot-keyword[data-count]:nth-child(n) {
    font-size: calc(14px + attr(data-count number) * 1px);
}

/* æ¨¡æ€æ¡† */
.modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
.modal-content { background-color: #fff; padding: 30px; border-radius: 10px; text-align: center; max-width: 90%; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
.modal-content img { margin-top: 20px; }
.btn { display: inline-block; margin-top: 15px; padding: 10px 20px; font-size: 16px; background-color: #1e90ff; color: #fff; text-decoration: none; border-radius: 5px; }
.btn:hover { background-color: #0f78d1; }

/* å“åº”å¼ */
@media (max-width: 480px){
    .search-container { flex-wrap: wrap; }
    .search-container input[type="text"] { flex: 1 1 100%; border-radius: 5px; margin-bottom: 8px; }
    .search-container button { flex: 1 1 100%; border-radius: 5px; }
}
</style>
</head>
<body>

<!-- logo -->
<div class="logo">
    <img src="static/logo.png" alt="Logo">
    <h1>å¤¸å…‹ç½‘ç›˜èµ„æºæœç´¢</h1>
</div>

<!-- æœç´¢æ¡† -->
<div class="search-container">
    <input type="text" id="searchInput" placeholder="è¯·è¾“å…¥èµ„æºå…³é”®è¯">
    <button id="searchBtn">æœç´¢</button>
</div>

<!-- é¦–é¡µæ¨èçƒ­æœ -->
<div id="recommend"></div>

<!-- å¼¹çª— -->
<div id="modal" class="modal">
    <div class="modal-content" id="modalBody"></div>
</div>

<script>
/* ========= ç»Ÿè®¡æ¨¡å— ========= */
const Stats = {
    get(key, def) { try { return JSON.parse(localStorage.getItem(key)) ?? def } catch { return def } },
    set(key, val) { localStorage.setItem(key, JSON.stringify(val)) },
    pageView() { const pv=this.get('page_pv',0); this.set('page_pv',pv+1) },
    recordKeyword(keyword, found) {
        const map=this.get('search_keywords',{});
        if(!map[keyword]) map[keyword]={count:0,found:0};
        map[keyword].count++;
        if(found) map[keyword].found++;
        this.set('search_keywords',map)
    },
    hotList(limit=10){
        const map=this.get('search_keywords',{});
        return Object.entries(map).sort((a,b)=>b[1].count-a[1].count).slice(0,limit);
    }
}
Stats.pageView()

/* ========= æœç´¢é€»è¾‘ ========= */
const modal=document.getElementById('modal');
const modalBody=document.getElementById('modalBody');
const searchBtn=document.getElementById('searchBtn');
const searchInput=document.getElementById('searchInput');

modal.addEventListener('click', e=>{ if(e.target===modal) modal.style.display='none' });

async function loadData() {
    try { const res=await fetch(`data.json?t=${Date.now()}`); return await res.json(); }
    catch { return []; }
}

function highlight(text, keyword) {
    if(!keyword) return text;
    const reg = new RegExp(`(${keyword})`,'gi');
    return text.replace(reg,'<span class="highlight">$1</span>');
}

async function search() {
    const keyword=searchInput.value.trim().toLowerCase();
    if(!keyword) return;
    const data=await loadData();
    const item=data.find(d=>d.title.toLowerCase().includes(keyword)||d.keywords.some(k=>k.toLowerCase().includes(keyword)));
    const isMobile=/Mobi|Android|iPhone/i.test(navigator.userAgent);
    let html='';
    if(item){
        html=`<h3>${highlight(item.title, keyword)}</h3>`;
        if(isMobile){
            html+=`<p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è®¿é—®èµ„æº</p><a href="${item.share_link}" target="_blank" class="btn">ç‚¹å‡»å‰å¾€</a>`;
        }else{
            html+=`<p>è¯·ä½¿ç”¨å¤¸å…‹æˆ–å¾®ä¿¡æ‰«æä¸‹æ–¹äºŒç»´ç è®¿é—®èµ„æº</p><img src="${item.qrcode}" style="width:200px;height:200px;">`;
        }
    }else{
        html=`<h3>æœªæ‰¾åˆ°èµ„æº</h3><p>è¯·æ‰«ç åŠ å…¥èµ„æºç¾¤è·å–æ›´å¤šèµ„æº</p><img src="static/wechat_qrcode.png" style="width:350px;height:350px;">`;
    }
    modalBody.innerHTML=html;
    modal.style.display='flex';
    Stats.recordKeyword(keyword,!!item);
    renderRecommend(); // ğŸ”¥ æœç´¢ååˆ·æ–°æ¨èåŒº
}

searchBtn.addEventListener('click', search);
searchInput.addEventListener('keypress', e=>{ if(e.key==='Enter') search(); });

/* ========= é¦–é¡µæ¨èçƒ­æœï¼ˆåŠ¨æ€é«˜äº®ç‰ˆï¼‰ ========= */
function renderRecommend() {
    const hot=Stats.hotList(10).filter(([_,v])=>v.count>=10);
    if(!hot.length){ document.getElementById('recommend').innerHTML=''; return; }

    let html=`<div class="recommend-card"><h3>ğŸ”¥ å¤§å®¶éƒ½åœ¨æœ</h3>`;
    const maxCount = Math.max(...hot.map(([_,v])=>v.count));
    hot.forEach(([kw,v])=>{
        const size = 14 + Math.round(6 * (v.count/maxCount)); // å­—å· 14~20px
        const color = `rgb(${50+Math.round(205*(v.count/maxCount))},${100},${255})`; // è“è‰²æ¸å˜
        html+=`<span class="hot-keyword" style="font-size:${size}px;color:${color}" onclick="searchInput.value='${kw}';searchBtn.click();">${kw}</span>`;
    });
    html+='</div>';
    document.getElementById('recommend').innerHTML=html;
}

renderRecommend();

/* ========= /#stats çƒ­æœæ¦œ ========= */
function renderStatsPage() {
    const pv=Stats.get('page_pv',0);
    const hot=Stats.hotList(20);
    let html=`<h2>ğŸ”¥ çƒ­æœæ¦œ</h2><p>é¡µé¢è®¿é—®é‡ï¼š${pv}</p><ol style="text-align:left">`;
    hot.forEach(([kw,v])=>{ html+=`<li><b>${kw}</b>ï¼ˆ${v.count} æ¬¡ï¼‰</li>` });
    html+='</ol>';
    modalBody.innerHTML=html;
    modal.style.display='flex';
}

window.addEventListener('hashchange',()=>{ if(location.hash==='#stats') renderStatsPage(); });
if(location.hash==='#stats') renderStatsPage();

/* ========= SEO ?q=å…³é”®è¯ ========= */
const params=new URLSearchParams(location.search);
const q=params.get('q');
if(q){ searchInput.value=q; setTimeout(()=>searchBtn.click(),300); }

</script>
</body>
</html>
