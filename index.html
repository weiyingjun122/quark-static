<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>夸克网盘资源搜索</title>
<style>
    body {
        font-family: "Microsoft YaHei", sans-serif;
        background: #f5f5f5;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    .logo {
        margin-top: 60px;
    }
    .logo img {
        width: 120px;
    }
    .logo h1 {
        font-size: 28px;
        margin: 10px 0 40px;
        color: #333;
    }
    .search-box {
        margin-bottom: 40px;
    }
    .search-box input {
        width: 300px;
        padding: 10px 15px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 24px 0 0 24px;
        outline: none;
    }
    .search-box button {
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        background: #4285f4;
        color: #fff;
        border-radius: 0 24px 24px 0;
        cursor: pointer;
        transition: background 0.3s;
    }
    .search-box button:hover {
        background: #3367d6;
    }
    #result-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        z-index: 9999;
        max-width: 90%;
        text-align: center;
    }
    #result-modal img {
        max-width: 250px;
        margin-bottom: 20px;
    }
    #result-modal a {
        display: inline-block;
        padding: 10px 20px;
        background: #4285f4;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-size: 16px;
    }
    #modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.3);
        z-index: 9998;
    }
</style>
</head>
<body>

<div class="logo">
    <img src="static/logo.png" alt="logo">
    <h1>夸克网盘资源搜索</h1>
</div>

<div class="search-box">
    <input type="text" id="kw" placeholder="请输入关键词搜索资源">
    <button onclick="search()">搜索</button>
</div>

<div id="modal-overlay"></div>
<div id="result-modal">
    <div id="modal-content"></div>
    <button onclick="closeModal()">关闭</button>
</div>

<script>
let DATA = [];

// 加载资源数据
fetch("data.json")
    .then(res => res.json())
    .then(d => DATA = d)
    .catch(err => console.error("加载 data.json 出错:", err));

// 判断是否手机端
function isMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

// 打开弹窗
function showModal(contentHtml) {
    const modal = document.getElementById("result-modal");
    const overlay = document.getElementById("modal-overlay");
    document.getElementById("modal-content").innerHTML = contentHtml;
    modal.style.display = "block";
    overlay.style.display = "block";
}

// 关闭弹窗
function closeModal() {
    document.getElementById("result-modal").style.display = "none";
    document.getElementById("modal-overlay").style.display = "none";
}

// 展示搜索结果
function showResults(list) {
    if (!list.length) return;
    const item = list[0]; // 默认只显示第一个匹配资源
    let html = "";
    if (isMobile()) {
        html = `<a href="${item.share_link}" target="_blank">点击打开资源</a>`;
    } else {
        html = `<img src="${item.qrcode}" alt="二维码"><br><a href="${item.share_link}" target="_blank">打开链接</a>`;
    }
    showModal(html);
}

// 搜索函数
function search() {
    if (!DATA.length) {
        alert("资源数据加载中，请稍等...");
        return;
    }

    const kw = document.getElementById("kw").value.trim().toLowerCase();
    if (!kw) return;

    const list = DATA.filter(i =>
        (i.title && i.title.toLowerCase().includes(kw)) ||
        (i.keywords && i.keywords.some(k => k.toLowerCase().includes(kw)))
    );

    if (!list.length) {
        // 未找到，加载 wechat.html 内容
        fetch("wechat.html")
            .then(r => r.text())
            .then(html => showModal(html));
        return;
    }

    showResults(list);
}
</script>

</body>
</html>
